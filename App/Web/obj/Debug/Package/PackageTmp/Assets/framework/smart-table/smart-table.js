!function (a, b) { "use strict"; a.module("smart-table", []).run(["$templateCache", function (a) { a.put("template/smart-table/pagination.html", '<div class="pagination" ng-if="pages.length >= 2"><ul class="pagination"><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li></ul></div>') }]), a.module("smart-table").controller("stTableController", ["$scope", "$parse", "$filter", "$attrs", function (c, d, e, f) { function r(a) { return a ? [].concat(a) : [] } function s() { m = r(j(c)), o === !0 && p.pipe() } var j, q, g = f.stTable, h = d(g), i = h.assign, k = e("orderBy"), l = e("filter"), m = r(h(c)), n = { sort: {}, search: {}, pagination: { start: 0 } }, o = !0, p = this; f.stSafeSrc && (j = d(f.stSafeSrc), c.$watch(function () { var a = j(c); return a ? a.length : 0 }, function (a, b) { a !== m.length && s() })), this.sortBy = function (b, c) { return n.sort.predicate = b, n.sort.reverse = c === !0, n.pagination.start = 0, this.pipe() }, this.loaded = function () { }, this.loadedStart = function () { }, this.search = function (b, c) { var d = n.search.predicateObject || {}, e = c ? c : "$"; return d[e] = b, b || delete d[e], n.search.predicateObject = d, n.pagination.start = 0, this.pipe() }, this.pipe = function () { var d = n.pagination, e = n.search.predicateObject ? l(m, n.search.predicateObject) : m; n.sort.predicate && (e = k(e, n.sort.predicate, n.sort.reverse)), d.number !== b && (d.numberOfPages = e.length > 0 ? Math.ceil(e.length / d.number) : 1, d.start = d.start >= e.length ? (d.numberOfPages - 1) * d.number : d.start, e = e.slice(d.start, d.start + parseInt(d.number))), i(c, e), this.loaded() }, this.select = function (c, d) { var e = m, f = e.indexOf(c); f !== -1 && ("single" === d ? (c.isSelected = c.isSelected !== !0, q && (q.isSelected = !1), q = c.isSelected === !0 ? c : b) : e[f].isSelected = !e[f].isSelected) }, this.slice = function (b, c) { return n.pagination.start = b, n.pagination.number = c, this.pipe() }, this.tableState = function () { return n }, this.setFilterFunction = function (b) { l = e(b) }, this.setSortFunction = function (b) { k = e(b) }, this.preventPipeOnWatch = function () { o = !1 } }]).directive("stTable", function () { return { restrict: "A", controller: "stTableController", link: function (a, b, c, d) { c.stSetFilter && d.setFilterFunction(c.stSetFilter), c.stSetSort && d.setSortFunction(c.stSetSort) } } }), a.module("smart-table").directive("stSearch", ["$timeout", function (a) { return { require: "^stTable", scope: { predicate: "=?stSearch" }, link: function (b, c, d, e) { var f = e, g = null, h = d.stDelay || 400; b.$watch("predicate", function (a, b) { a !== b && (e.tableState().search = {}, f.search(c[0].value || "", a)) }), b.$watch(function () { return e.tableState().search }, function (a, d) { var e = b.predicate || "$"; a.predicateObject && a.predicateObject[e] !== c[0].value && (c[0].value = a.predicateObject[e] || "") }, !0), c.bind("input", function (c) { c = c.originalEvent || c, null !== g && a.cancel(g), g = a(function () { f.search(c.target.value, b.predicate || ""), g = null }, h) }) } } }]), a.module("smart-table").directive("stSelectRow", function () { return { restrict: "A", require: "^stTable", scope: { row: "=stSelectRow" }, link: function (a, b, c, d) { var e = c.stSelectMode || "single"; b.bind("click", function () { a.$apply(function () { d.select(a.row, e) }) }), a.$watch("row.isSelected", function (a) { a === !0 ? b.addClass("st-selected") : b.removeClass("st-selected") }) } } }), a.module("smart-table").directive("stSort", ["$parse", function (c) { return { restrict: "A", require: "^stTable", link: function (d, e, f, g) { function o() { j++, h = a.isFunction(i(d)) ? i(d) : f.stSort, j % 3 === 0 && f.stSkipNatural === b ? (j = 0, g.tableState().sort = {}, g.tableState().pagination.start = 0, g.pipe()) : g.sortBy(h, j % 2 === 0) } var n, h = f.stSort, i = c(h), j = 0, k = f.stClassAscent || "sorting_asc", l = f.stClassDescent || "sorting_desc", m = [k, l]; f.stSortDefault && (n = d.$eval(f.stSortDefault) !== b ? d.$eval(f.stSortDefault) : f.stSortDefault), e.bind("click", function () { h && d.$apply(o) }), n && (j = "reverse" === f.stSortDefault ? 1 : 0, o()), d.$watch(function () { return g.tableState().sort }, function (a) { a.predicate !== h ? (j = 0, e.removeClass(k).removeClass(l).addClass("sorting")) : (j = a.reverse === !0 ? 2 : 1, e.removeClass("sorting").removeClass(m[j % 2]).addClass(m[j - 1])) }, !0) } } }]), a.module("smart-table").directive("stPagination", function () { return { restrict: "EA", require: "^stTable", scope: { stItemsByPage: "=?", stDisplayedPages: "=?" }, templateUrl: function (a, b) { return b.stTemplate ? b.stTemplate : "template/smart-table/pagination.html" }, link: function (a, b, c, d) { function e() { var e, f, b = d.tableState().pagination, c = 1; for (a.currentPage = Math.floor(b.start / b.number) + 1, c = Math.max(c, a.currentPage - Math.abs(Math.floor(a.stDisplayedPages / 2))), e = c + a.stDisplayedPages, e > b.numberOfPages && (e = b.numberOfPages + 1, c = Math.max(1, e - a.stDisplayedPages)), a.pages = [], a.numPages = b.numberOfPages, f = c; f < e; f++) a.pages.push(f) } a.stItemsByPage = a.stItemsByPage ? +a.stItemsByPage : 25, a.stDisplayedPages = a.stDisplayedPages ? +a.stDisplayedPages : 5, a.currentPage = 1, a.pages = [], a.$watch(function () { return d.tableState().pagination }, e, !0), a.$watch("stItemsByPage", function () { a.selectPage(1) }), a.$watch("stDisplayedPages", e), a.selectPage = function (b) { b > 0 && b <= a.numPages && d.slice((b - 1) * a.stItemsByPage, a.stItemsByPage) }, d.slice(0, a.stItemsByPage) } } }), a.module("smart-table").directive("stPipe", function () { return { require: "stTable", scope: { stPipe: "=" }, link: { pre: function (b, c, d, e) { a.isFunction(b.stPipe) && (e.preventPipeOnWatch(), e.pipe = function () { return b.stPipe(e.tableState(), e) }) } } } }), a.module("smart-table").directive("stLoaded", function (b) { return { require: "stTable", replace: !1, scope: { stLoaded: "=" }, link: { pre: function (b, c, d, e) { a.isFunction(b.stLoaded) && (e.loaded = function () { return b.stLoaded(e.tableState(), e) }) } } } }), a.module("smart-table").directive("stLoadStart", function () { return { require: "stTable", scope: { stLoadStart: "=" }, link: { pre: function (b, c, d, e) { a.isFunction(d.stLoadStart) && (e.loadStart = function () { return b.stLoadStart(e.tableState(), e) }) } } } }), a.module("smart-table").directive("stResetSearch", function () { return { restrict: "EA", require: "^stTable", link: function (a, b, c, d) { return b.bind("click", function () { return a.$apply(function () { var a; return a = d.tableState(), a.search.predicateObject = {}, a.pagination.start = 0, d.pipe() }) }) } } }) }(angular);